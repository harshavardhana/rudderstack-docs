---
# slug: "/docs/data-warehouse-integrations/snowflake"
title: "Snowflake"
description: Step-by-step guide to add Snowflake as a destination in RudderStack
---

# Snowflake

Snowflake is a cloud-based data warehouse provided as Software-as-a-Service \(SaaS\). It offers all the modern data warehouse features like scalability, ease of use, secure access to your data, advanced analytics capabilities, and more.

RudderStack lets you configure Snowflake as a destination to seamlessly store your event data.

<div class="infoBlock">

Refer to the <a href="https://rudderstack.com/docs/data-warehouse-integrations/warehouse-schemas/">Warehouse Schemas</a> guide for information on how the events are mapped to the Snowflake tables.
</div>

<div class="successBlock">

<strong>Find the open-source transformer code for this destination in the <a href="https://github.com/rudderlabs/rudder-transformer/tree/master/v0/destinations/snowflake">RudderStack GitHub</a> repo.</strong>
</div>

## Setting up a user in Snowflake

To enable RudderStack access, make sure you have an `ACCOUNTADMIN`, or an account that has the `MANAGE GRANTS` privilege.

The following sections illustrate how to set up a virtual warehouse, a database, a role, and an user in Snowflake:

### Creating a virtual warehouse

In your Snowflake console, create a `X-Small` warehouse:

<img src="../assets/dw-integrations/snowflake-create-warehouse.png" />

<div class="infoBlock">

Set your data warehouse size as per your data volume requirements.
</div>

Alternatively, you can create a new warehouse by running the following SQL commands:

```sql
CREATE WAREHOUSE "RUDDER_WAREHOUSE"
  WITH WAREHOUSE_SIZE = 'XSMALL'
    WAREHOUSE_TYPE = 'STANDARD'
    AUTO_SUSPEND = 600
    AUTO_RESUME = TRUE;
```

<div class="infoBlock">

We recommend that you set <code class="inline-code">AUTO_SUSPEND</code> to ~10 mins and enable <code class="inline-code">AUTO_RESUME</code> to avoid any extra costs.
</div>

### Creating a database

<div class="warningBlock">

Create a new database to avoid conflicts with your existing data, as RudderStack creates its own tables while storing your events.
</div>

The following image demonstrates the **Create Database** option in Snowflake.

<img src="../assets/dw-integrations/snowflake-create-database.png" />

Alternatively, you can create a new database by running the following SQL command:

```sql
CREATE DATABASE "RUDDER_EVENTS";
```

### Creating a role for RudderStack

Run the following SQL commands to create a new role with the required permissions to load your data into the newly-created warehouse:

1. Create a new role called `RUDDER`:

```sql
CREATE ROLE "RUDDER";
```

2. Grant access to the warehouse `RUDDER_WAREHOUSE`:

```sql
GRANT USAGE ON WAREHOUSE "RUDDER_WAREHOUSE" TO ROLE "RUDDER";
```

3. Grant access to the database `RUDDER_EVENTS`:

```sql
GRANT USAGE ON DATABASE "RUDDER_EVENTS" TO ROLE "RUDDER";
GRANT CREATE SCHEMA ON DATABASE "RUDDER_EVENTS" TO ROLE "RUDDER";
GRANT ALL ON ALL SCHEMAS IN DATABASE "RUDDER_EVENTS" TO ROLE "RUDDER";
```

### Creating a user

Finally, create a user to connect RudderStack to the newly-created Snowflake warehouse, as shown:

<img src="../assets/dw-integrations/snowflake-create-user.png" alt="New Snowflake user" />

Alternatively, you can use SQL to create a user in Snowflake, as shown:

```sql
CREATE USER "RUDDER_USER"
  MUST_CHANGE_PASSWORD = FALSE
  DEFAULT_ROLE = "RUDDER"
  PASSWORD = "<your_password>";
GRANT ROLE "RUDDER" TO USER "RUDDER_USER";
```

## Configuring Snowflake destination in RudderStack

To start sending data to Snowflake, you will first need to add it as a destination in RudderStack and connect it to a data source. Once the destination is enabled, the events will automatically start flowing to your Snowflake instance.

Follow these steps to configure your Azure data lake as a destination in RudderStack:

* From your [**RudderStack dashboard**](https://app.rudderstack.com/), configure the data source. Then, select **Snowflake** from the list of destinations.

<div class="infoBlock">

Refer to the <a href="https://rudderstack.com/docs/connections/adding-source-and-destination-rudderstack//">Adding a Source and Destination in RudderStack</a> guide for more information.
</div>

* Assign a name to your destination and click on **Next**. You should then see the following screen:

<img src="../assets/dw-integrations/snowflake-connection-settings.png" alt="Snowflake destination settings in RudderStack" />
<img src="../assets/dw-integrations/snowflake-connection-settings-1.png" alt="Snowflake destination settings in RudderStack" />

### Connection settings

Add the following credentials to set up the Snowflake destination:

  - **Account**: Enter the account ID of your Snowflake warehouse. This account ID is part of the Snowflake URL. 
  
  The following examples illustrate the slight differences in the account ID for various cloud providers:

  | Account ID example            | Corresponding Snowflake URL                                                    | Snowflake cloud provider                                        |
  | :-------------------------- | :--------------------------------------------------------------- | :-------------------------------------------------------------- |
  | `qya56091.us-east-1`         | `https://`**`qya56091.us-east-1`**`.snowflakecomputing.com`      | AWS                                   |
  | `rx18795.east-us-2.azure` | `https://`**`rx18795.east-us-2.azure`**`.snowflakecomputing.com` | Microsoft Azure  |
  | `ah76025.us-central1.gcp` | `https://`**`ah76025.us-central1.gcp`**`.snowflakecomputing.com` | Google Cloud Platform                          |

  - **Database**: Enter the name of the database created in the [**Creating a database**](#creating-a-database) section above.

  - **Warehouse**: Enter the name of the warehouse created in the [**Creating a virtual warehouse**](#creating-a-virtual-warehouse) section above.

  - **User**: Enter the name of the user created in the [**Creating a user**](#creating-a-user) section above.

  - **Password**: Enter the password you set for the above user.

  - **Namespace**: Enter the schema name for the warehouse where RudderStack will create all the tables.

  <div class="infoBlock">

  If you don't specify any namespace, RudderStack will set this to the source name by default.
  </div>

  - **Sync Frequency**:  Specify how often RudderStack should sync the data to your Snowflake warehouse.

  - **Sync Starting At**: This optional setting lets you specify the particular time of the day (in UTC) when you want RudderStack to sync the data to the warehouse.

  - **Exclude Window**: This optional setting lets you set a time window when RudderStack **will not** sync the data to the warehouse.

  ### Configuring the object storage

  RudderStack lets you configure the following object storage configuration settings while setting up your Snowflake destination:

  - **Use RudderStack-managed Object Storage**: Enable this setting to use RudderStack-managed buckets for object storage.

   <div class="warningBlock">

  This option is applicable only for RudderStack-hosted data planes. For self-hosted data planes, you will have to specify your own object storage configuration settings.
  </div>

  - **Choose your Cloud**: Select the cloud provider for your Snowflake instance.

Refer to the following settings depending on your cloud provider:

<Tabs>
  <TabList>
    <Tab>AWS</Tab>
    <Tab>Azure</Tab>
    <Tab>GCP</Tab>
  </TabList>
  <TabPanels>
    <TabPanel>
    <ul>
      <li><strong>Staging S3 Storage Bucket Name</strong>: Specify the name of your S3 bucket where RudderStack will store the data before loading it into Snowflake.</li>
      <li><strong>Prefix</strong>: If specified, RudderStack will create a folder in the bucket with this prefix and push all the data within that folder.</li>
      <li><strong>Storage Integration</strong>: Refer to the <a href="#configuring-snowflake-integration">Configuring Snowflake integration</a> section for details.</li>
      <li><strong>AWS Access Key ID</strong>: Enter your AWS access key ID obtained from the AWS console.</li>
      <li><strong>AWS Secret Access Key</strong>:  Enter the AWS secret access key.  Refer to this <a href="https://rudderstack.com/docs/destinations/storage-platforms/amazon-s3#setting-up-amazon-s3">Permissions</a> section for more information. </li>
      <li><strong>Enable Server-side Encryption for S3</strong>: Toggle on this setting to enable server-side encryption for your S3 bucket.</li>
    </ul>
    </TabPanel>
    <TabPanel>
    <ul>
      <li><strong>Staging Azure Blob Storage Container Name</strong>: Specify the name of your Azure container where RudderStack will store the data before loading it into Snowflake.</li>
      <li><strong>Prefix</strong>: If specified, RudderStack will create a folder in the bucket with this prefix and push all the data within that folder.</li>
      <li><strong>Storage Integration</strong>: Refer to the <a href="#configuring-snowflake-integration">Configuring Snowflake integration</a> section for details.</li>
      <li><strong>Azure Blob Storage Account Name</strong>: Enter the account name for the Azure container.</li>
      <li><strong>Azure Blob Storage Account Key</strong>:  Enter the account key for your Azure container.  Refer to the <a href="https://www.rudderstack.com/docs/destinations/storage-platforms/microsoft-azure-blob-storage/#setting-up-azure-blob-storage">Blob Storage setup</a> section for more information. </li>
    </ul>
    </TabPanel>
    <TabPanel>
    <ul>
      <li><strong>Staging GCS Object Storage Bucket Name</strong>: Specify the name of your GCS bucket where RudderStack will store the data before loading it into Snowflake.</li>
      <li><strong>Prefix</strong>: If specified, RudderStack will create a folder in the bucket with this prefix and push all the data within that folder.</li>
      <li><strong>Storage Integration</strong>: Refer to the <a href="#configuring-snowflake-integration">Configuring Snowflake integration</a> section for details.</li>
      <li><strong>Credentials</strong>: Paste the contents of your GCP service account credentials JSON. The service account should have a role with <code class="inline-code">storage.objectCreator</code> access. </li>
    </ul>
    </TabPanel>
  </TabPanels>
</Tabs>

## Configuring cloud storage integration with Snowflake

This section lists the steps required to configure the **Storage Integration** setting specified in the [**Configuring the object storage**](#configuring-the-object-storage) section above, depending on your cloud provider.

<Tabs>
  <TabList>
    <Tab>AWS</Tab>
    <Tab>Azure</Tab>
    <Tab>GCP</Tab>
  </TabList>
  <TabPanels>
    <TabPanel>
        If you have Amazon Web Services (AWS) as your cloud provider and want to leverage S3 as your object storage, you will need to follow a few more steps to configure your Snowflake warehouse destination. Detailed instructions can be found in this <a href="https://docs.snowflake.com/en/user-guide/data-load-s3-config.html#option-1-configuring-a-snowflake-storage-integration">Snowflake documentation</a>.

<ol>
<li>Create a policy in AWS:</li>

Replace <code class="inline-code">&lt;bucket&gt;</code> and <code class="inline-code">&lt;prefix&gt;</code> with your values in the JSON below. And create the policy with a name of your choice.
<span>

```javascript
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:GetObjectVersion",
        "s3:DeleteObject",
        "s3:DeleteObjectVersion"
      ],
      "Resource": "arn:aws:s3:::<bucket>/<prefix>/*"
    },
    {
      "Effect": "Allow",
      "Action": "s3:ListBucket",
      "Resource": "arn:aws:s3:::<bucket>",
      "Condition": {
        "StringLike": {
          "s3:prefix": ["<prefix>/*"]
        }
      }
    }
  ]
}
```
</span>
<li>
  Create a role and attach the above policy in AWS: - Create role of type <strong>
    Another AWS account
  </strong> - Enter your AWS account ID and enable <strong>
    Require External ID
  </strong> - For external ID enter a dummy ID such as 0000. We will modify this
  later on. - And attach the policy created in Step 1. - Give your role a name and
  keep the role ARN handy for the next step.
</li>
<li> Create cloud storage integration in Snowflake </li>
<span>

```sql
CREATE STORAGE INTEGRATION <integration_name>
  TYPE = EXTERNAL_STAGE
  STORAGE_PROVIDER = S3
  ENABLED = TRUE
  STORAGE_AWS_ROLE_ARN = '<iam_role>'
  STORAGE_ALLOWED_LOCATIONS = ('s3://<bucket>/<path>/', 's3://<bucket>/<path>/')
  [ STORAGE_BLOCKED_LOCATIONS = ('s3://<bucket>/<path>/', 's3://<bucket>/<path>/') ]
```
</span>
<code class="inline-code">&lt;integration_name&gt;</code> with an integration
name of your choice.
<code class="inline-code">&lt;iam_role&gt;</code> with the role ARN from the
previous step.

Record the values: <code class="inline-code">&lt;integration_name&gt;</code>.

<li> Retrieve the AWS IAM user for your Snowflake account as shown:</li>
<span>

```sql
DESC INTEGRATION <integration_name>;
```
</span>
<code class="inline-code">&lt;integration_name&gt;</code> - The integration name
used in the previous step.

Record the values - <code class="inline-code">STORAGE_AWS_ROLE_ARN</code> and <code class="inline-code">STORAGE_AWS_EXTERNAL_ID</code> .

<li> Grant IAM user permission to access bucket objects in AWS </li>
Choose the role created in Step 2 and edit the trust relationship with the following
JSON.
<span>

```javascript
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "",
      "Effect": "Allow",
      "Principal": {
        "AWS": "<snowflake_user_arn>"
      },
      "Action": "sts:AssumeRole",
      "Condition": {
        "StringEquals": {
          "sts:ExternalId": "<snowflake_external_id>"
        }
      }
    }
  ]
}
```
</span>
<code class="inline-code">&lt;snowflake_user_arn&gt;</code> is the <code class="inline-code">
  STORAGE_AWS_ROLE_ARN
</code> in the previous step.
<code class="inline-code">&lt;snowflake_external_id&gt;</code> is the <code class="inline-code">
  STORAGE_AWS_EXTERNAL_ID
</code> in the previous step.

<li> Grant integration access to role in Snowflake:</li>
<span>

```sql
grant usage on integration <integration_name> to role <sf_role>
```
</span>
  <code class="inline-code">&lt;integration_name&gt;</code> is the integration created in the Step 3.
  <code class="inline-code">&lt;sf_role&gt;</code> is the role in Snowflake you want to grant access to.
</ol>
      </TabPanel>
      <TabPanel>
        If you have Microsoft Azure as your cloud provider and want to leverage Azure Blob Storage as your object storage, you will need to follow a few more steps to configure your Snowflake destination with a snowflake integration.

Detailed instructions can be found <a href="https://docs.snowflake.com/en/user-guide/data-load-azure-config.html#option-1-configuring-a-snowflake-storage-integration">here</a>.

**Configuring snowflake integration with Azure **
<ol>
<li>Create a storage account in Azure.</li>
<li>

Create a container in the storage account created above by navigating to **&lt;storage_account&gt;** - **Storage Explorer** - **Blob Containers** - **Create a Blob Container**.
</li>
<li>Create cloud storage integration in Snowflake:
<span>

```sql
CREATE STORAGE INTEGRATION <integration_name>
TYPE = EXTERNAL_STAGE
STORAGE_PROVIDER = AZURE
ENABLED = TRUE
AZURE_TENANT_ID = '<tenant_id>'
STORAGE_ALLOWED_LOCATIONS = ('azure://<account>.blob.core.windows.net/<container>/<path>/', 'azure://<account>.blob.core.windows.net/<container>/<path>/')
[ STORAGE_BLOCKED_LOCATIONS = ('azure://<account>.blob.core.windows.net/<container>/<path>/', 'azure://<account>.blob.core.windows.net/<container>/<path>/') ]
```
</span>
<code class="inline-code">&lt;tenant_id&gt;</code> - Get your tenant id by
navigating to <strong>Azure Active Directory</strong> - <strong>
  Properties.
</strong> The tenant ID is displayed in the <strong>Directory ID</strong> field.
<strong>&lt;account&gt;</strong> - <strong>&lt;storage_account&gt;</strong> - <strong>
  Access keys
</strong> - &lt;<code class="inline-code">storageAccountName</code>&gt;

</li>
<li> Grant Snowflake access to the storage locations </li>

Replace <code class="inline-code">&lt;integration_name&gt;</code> with the integration name created in the previous step.
<span>

```sql
DESC INTEGRATION <integration_name>;
```
</span>
And record the values <code class="inline-code">AZURE_CONSENT_URL</code> and <code class="inline-code">AZURE_MULTI_TENANT_APP_NAME</code> .
<li>
  Navigate to the URL in the <code class="inline-code">
    AZURE_CONSENT_URL
  </code> obtained in the previous step and accept.
</li>
<li>

  Grant snowflake access to the container created in Step 2: - Navigate to
  <strong>Azure Services</strong> - <strong>Storage Accounts</strong> and select
  the storage account created in Step 1. - Add role : Navigate to
  <strong>Access Control (IAM)</strong> - <strong>Add Role Assignment</strong>
  and select either <strong>Storage Blob Data Reader(Read Access)</strong> or
  <strong>Storage Blob Data Contributor (Read and Write Access)</strong> - Add
  <strong>Assign Access</strong> : Add <strong>Service Principal</strong> as the
  type of security principal to assign the role to. And search for
  <code class="inline-code">AZURE_MULTI_TENANT_APP_NAME</code> obtained in step
  4.
</li>
<li>Grant integration access to role in Snowflake:</li>
<span>

```sql
grant usage on integration <integration_name> to role <sf_role>;
```
</span>
  <code class="inline-code">&lt;integration_name&gt;</code> is the integration created in the Step 4.
  <code class="inline-code">&lt;sf_role&gt;</code> is the role in Snowflake you want to grant access to.
</ol>
      </TabPanel>
      <TabPanel>
        If you have Google Cloud Platform (GCP) as your cloud provider and want to leverage Google Cloud Storage as your object storage, you will need to follow a few more steps to configure your Snowflake destination with a snowflake integration.

Detailed instructions can be found <a href="https://docs.snowflake.com/en/user-guide/data-load-gcs-config.html#configuring-an-integration-for-google-cloud-storage">here</a>.

**Configuring Snowflake Integration with Google Cloud Platform **

<ol>
<li>Create a Cloud Storage integration in Snowflake.</li>
<span>

```sql
CREATE STORAGE INTEGRATION <integration_name>
  TYPE = EXTERNAL_STAGE
  STORAGE_PROVIDER = GCS
  ENABLED = TRUE
  STORAGE_ALLOWED_LOCATIONS = ('gcs://<bucket>/<path>/', 'gcs://<bucket>/<path>/')
```
</span>
<ul>
  <li>
    <code class="inline-code">&lt;integration_name&gt;</code> is the name of the
    new integration being created
  </li>
  <li>
    <code class="inline-code">&lt;bucket&gt;</code> is the name of the Cloud
    Storage bucket that you created
    <a href="https://rudderstack.com/docs/data-warehouse-integrations/snowflake/#configuring-snowflake-in-rudderstack">
      above
    </a>
  </li>
  <li>
    <code class="inline-code">&lt;path&gt;</code> is an optional path that can
    be used to provide granular control over objects in the bucket
  </li>
</ul>
<li>
  Retrieve the Cloud Storage Service Account for your Snowflake account. The
  following <code class="inline-code">DESCRIBE</code> command will retrieve the
  ID for the Cloud Storage service account that was created for your Snowflake
  account.
</li>
<span>

```sql
DESC STORAGE INTEGRATION <integration_name>;
```
</span>
<ul>
  <li>
    Where <code class="inline-code">&lt;integration_name&gt;</code> is the name
    of the integration you specified above in step 1.
  </li>
  <li>
    The output will be a table that has a property called
    <code class="inline-code">STORAGE_GCP_SERVICE_ACCOUNT</code>. Retrieve that
    property value.
  </li>
  <li>
    The value that should be retrieved will have the following format:
    <code class="inline-code">
      service-account-id@&lt;unique_string&gt;.iam.gserviceaccount.com
    </code>
  </li>
</ul>
<li> Grant the Service Account Permissions to Access Bucket Objects</li>
<ul>
  <li>
    Create a custom IAM role that has the permissions required to access the
    bucket and get objects.
  </li>
</ul>

     1. Log into the Google Cloud Platform Console as a project editor
     2. From the home dashboard, choose IAM & admin » Roles.
     3. Click Create Role.
     4. Enter a name, and description for the custom role.
     5. Click Add Permissions.
     6. Filter the list of permissions, and add the following from the list below:
        | Permission Property Name |
        | :----------------------- |
        | <code class="inline-code">storage.buckets.get</code>    |
        | <code class="inline-code">storage.objects.get</code>    |
        | <code class="inline-code">storage.object.list</code>    |
        | <code class="inline-code">storage.objects.create</code> |
     7. Click Create

<li> Assigning the Custom Role to the Cloud Storage Service Account</li>

  <ul>
   <li>Log into the Google Cloud Platform Console as a project editor.</li>
   <li>From the home dashboard, choose Cloud Storage » Browser:</li>
   <li>Select the checkbox of the bucket you would like to configure for access.</li>
   <li>Click SHOW INFO PANEL in the upper-right corner. The information panel for the bucket will slide out from the right.</li>
   <li>In the Add members field, search for the service account name from the DESCRIBE INTEGRATION output in Step 2: Retrieve the Cloud Storage Service Account for your Snowflake Account (in this topic).</li>
   <li>From the Select a role dropdown, select Storage » Custom » <code class="inline-code">&lt;role&gt;</code>, where <code class="inline-code">&lt;role&gt;</code> is the custom Cloud Storage role you created in Creating a Custom IAM Role (in this topic).</li>
   <li>Click the Add button. The service account name is added to the Storage Object Viewer role dropdown in the information panel.</li>
  </ul>

  <li> Grant usage to an external (i.e. Cloud Storage) stage that references the integration you created.
<span>

```sql
GRANT USAGE ON INTEGRATION <integration_name> TO ROLE "RUDDER";
```
</span>
</li>
</ol>
        <div class="infoBlock">
        <ul>
            <li>
              <code class="inline-code">"RUDDER"</code> is the name of the role that you
              created above <a href="https://rudderstack.com/docs/data-warehouse-integrations/snowflake/#creating-a-role-for-rudderstack">
                here
              </a>
            </li>
            <li>
              <code class="inline-code">&lt;integration_name&gt;</code> is the name of
              the integration that you set above in step 1
            </li>
          </ul>
        </div>
    </TabPanel>
  </TabPanels>
</Tabs>

## Setting up network access

You will need to whitelist the following RudderStack IPs to enable network access:

- 3.216.35.97
- 34.198.90.241
- 54.147.40.62
- 23.20.96.9
- 18.214.35.254

The EU cluster IPs are listed below:

- 3.66.99.198
- 3.64.201.167

<div class="infoBlock">

All the outbound traffic is routed through these RudderStack IPs.
</div>

## Contact us

For queries on any of the sections covered in this guide, you can [**contact us**](mailto:%20docs@rudderstack.com) or start a conversation in our [**Slack**](https://rudderstack.com/join-rudderstack-slack-community) community.
